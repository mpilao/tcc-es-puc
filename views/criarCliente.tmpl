
<!doctype html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Movimento Academia</title>
    <link rel="stylesheet" href="assets/css/bootstrap.min.css" >
    <link href="/assets/css/criar.css" rel="stylesheet">
    <script src="/assets/js/script.js"></script>
    
</head>
<body>   
    <@MENU>
    
    <div class="container mt-3">
        <h1 class="mb-4">Incluir Cliente</h1>
        <form  method="POST" id="incluirCliente" name="incluirCliente">
            <div class="row">
                <div class="col-md">
                    <div class="form-label-group">
                        <input type="text" id="nome" class="form-control" placeholder="Nome" required autofocus name="nome" pattern="(\w.+\s).+">
                        <label for="nome">Nome*</label>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md">
                    <div class="form-label-group">
                        <input type="text" id="cpf" class="form-control cpf" placeholder="012.345.678.90" required name="cpf" pattern="\d{3}\.?\d{3}\.?\d{3}-?\d{2}">
                        <label for="cpf">CPF*</label>
                    </div>
                </div>
                <div class="col-md">
                    <div class="form-label-group">
                        <input type="text" id="rg" class="form-control rg" placeholder="RG" required  name="rg" pattern="\d{2}\.?\d{3}\.?\d{3}-?\d{1,2}">
                        <label for="rg">RG*</label>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md">
                    <div class="form-label-group">
                        <input type="text" id="endereco" class="form-control" placeholder="Endereço" required  name="endereco" pattern="(\w.+\s).+">
                        <label for="endereco">Endereço*</label>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md">
                    <div class="form-label-group">
                        <input type="password" id="biometria" class="form-control" required  name="biometria" value="">
                        <label for="endereco">Biometria*</label>
                    </div>
                </div>
                <div class="col-md">
                    <button type="button" class="btn btn-lg btn-secondary btn-block btn-add-biometria d-none" onclick="gerarBiometria($('#biometria'), this);">Cadastrar Biometria</button>
                    <button type="button" class="btn btn-lg btn-danger btn-block btn-remove-biometria d-none" onclick="removeBiometria($('#biometria'), this);">Remover Biometria</button>                    
                </div>  
            </div>
            <div class="row">
                <div class="col-md">
                    <div class="form-label-group">    
                        <select class="form-control" id="tipo-plano" name="tipo-plano" required>
                            <option value="">Tipo de Plano*</option>
                            <option value="0">Anual</option>
                            <option value="1">Mensal</option>
                        </select>
                    </div>
                </div> 
            </div>
            <div class="row">
                <div class="col-md">
                    <a class="btn btn-lg btn-secondary btn-block" href="listagemCliente.php">Cancelar</a>
                </div>
                <div class="col-md">
                    <button class="btn btn-lg btn-secondary btn-block" type="submit">Cadastrar</button>
                </div>
            </div>
            
        </form>
    </div>
    
    <!-- Modal -->
    <div class="modal fade" id="includedModal" tabindex="-1" role="dialog" aria-labelledby="includedModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="includedModalLabel">Incluir</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary btn-close" data-dismiss="modal">Fechar</button>
                </div>
            </div>
        </div>
    </div>
    
    
    <script src="/assets/js/jquery.js"></script>
    <script src="assets/js/bootstrap.bundle.min.js" ></script>
    <script src="https://igorescobar.github.io/jQuery-Mask-Plugin/js/jquery.mask.min.js"></script>
    
    <script>
        
        $(document).ready(function(){
            $('.cpf').mask('000.000.000-00');
            $('.rg').mask('00.000.000-00');
            
            
            if( $("#biometria").length > 0 ) {
                if( $("#biometria").val() == "" ) {
                    $(".btn-add-biometria").removeClass("d-none");
                } else {
                    $(".btn-remove-biometria").removeClass("d-none");
                }
            }
            
            $('#deleteModal').on('show.bs.modal', function (e) {
                
                var button = $(e.relatedTarget);
                var url_redirect = button[0].href;
                $('#deleteModal .btn-excluir').click(function () {
                    window.location.href = url_redirect;
                });
                
            });
            
            $("#incluirCliente").on('submit', function(){
                form = $(this);
                $.ajax({
                    url: "insertCliente.php",
                    data: form.serialize(),
                    cache: false,
                    success:function(result){
                        console.log(result);
                        if(result == 2) {
                            msg = "Cliente incluído com sucesso!"
                    
                            $('#includedModal .btn-close').click(function () {
                                document.location.href = 'listagemCliente.php'
                            });

                        } else if(result == 'exists') {
                            msg = "Não foi possível incluir Cliente! O CPF já existe no sistema!"
                        } else {
                            msg = "Não foi possível incluir Cliente! Tente novamente mais tarde."
                        }
                        
                        $('#includedModal').modal('show').find('.modal-body p').text(msg);
                            
                        },
                        error: function(result) {
                            if(result == 1) {
                                msg = "Cliente incluído com sucesso!"
                                $('#includedModal .btn-close').click(function () {
                                document.location.href = 'listagemCliente.php'
                            });
                            } else if(result == 'exists') {
                                msg = "Não foi possível incluir Cliente! O CPF já existe no sistema!"
                                $('#includedModal .btn-close').click(function () {
                                document.location.href = 'listagemCliente.php'
                            });
                            } else {
                                msg = "Não foi possível incluir Cliente! Tente novamente mais tarde."
                            }
                            
                            $('#includedModal').modal('show').find('.modal-body p').text(msg);
                            
                        }
                    });
                    
                    return false;
                });
                
            });
        </script>        
    </body>
    </html>